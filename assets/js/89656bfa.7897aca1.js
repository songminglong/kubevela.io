(self.webpackChunkkubevela_io=self.webpackChunkkubevela_io||[]).push([[55706],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(n),m=o,h=d["".concat(l,".").concat(m)]||d[m]||u[m]||a;return n?r.createElement(h,i(i({ref:t},c),{},{components:n})):r.createElement(h,i({ref:t},c))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var p=2;p<a;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},10196:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return i},metadata:function(){return s},toc:function(){return l},default:function(){return c}});var r=n(22122),o=n(19756),a=(n(67294),n(3905)),i={title:"Deploy Kubernetes Raw Resource"},s={unversionedId:"deliver-app/k8s-object",id:"deliver-app/k8s-object",isDocsHomePage:!1,title:"Deploy Kubernetes Raw Resource",description:"This section introduces that how you can deploy Kubernetes raw resources into multi environments and clusters.",source:"@site/docs/deliver-app/k8s-object.mdx",sourceDirName:"deliver-app",slug:"/deliver-app/k8s-object",permalink:"/docs/next/deliver-app/k8s-object",editUrl:"https://github.com/oam-dev/kubevela.io/edit/main/docs/deliver-app/k8s-object.mdx",version:"current",lastUpdatedBy:"Wei (\u6bb5\u5c11)",lastUpdatedAt:1640087002,formattedLastUpdatedAt:"12/21/2021",frontMatter:{title:"Deploy Kubernetes Raw Resource"},sidebar:"docs",previous:{title:"Deploy Helm Chart",permalink:"/docs/next/deliver-app/helm"},next:{title:"Jenkins CI/CD",permalink:"/docs/next/case-studies/jenkins-cicd"}},l=[{value:"Before starting",id:"before-starting",children:[]},{value:"Scheduling and creating Targets",id:"scheduling-and-creating-targets",children:[]},{value:"Creating Kubernetes application",id:"creating-kubernetes-application",children:[]},{value:"Deploying test environment",id:"deploying-test-environment",children:[]},{value:"Deploying prod environment",id:"deploying-prod-environment",children:[]},{value:"Next step",id:"next-step",children:[]}],p={toc:l};function c(e){var t=e.components,i=(0,o.Z)(e,["components"]);return(0,a.kt)("wrapper",(0,r.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"This section introduces that how you can deploy Kubernetes raw resources into multi environments and clusters."),(0,a.kt)("p",null,"KubeVela supports you to render, orchestrate and deploy Kubernetes raw resources. The common usage type is Deployment+Service. Using customized Workflow, you can deploy an application into multi-cluster in sequence. Hence you'll get to know:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Deploy Kubernetes raw resources."),(0,a.kt)("li",{parentName:"ol"},"Workflow and its usage."),(0,a.kt)("li",{parentName:"ol"},"Multi-env/cluster in application delivery."),(0,a.kt)("li",{parentName:"ol"},"The control loop of application deployment: Rollback, Terminate and Continue.")),(0,a.kt)("h2",{id:"before-starting"},"Before starting"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Prepare a Deployment+Service resource, or directly use the example as below:"),(0,a.kt)("details",null," ",(0,a.kt)("summary",null,"Check out Demo example"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'---\napiVersion: apps/v1 # for versions before 1.9.0 use apps/v1beta2\nkind: Deployment\nmetadata:\nname: nginx\nspec:\nstrategy:\n    type: Recreate\nselector:\n    matchLabels:\n    app: nginx\nreplicas: 1 # tells deployment to run 1 pods matching the template\ntemplate: # create pods using pod definition in this template\n    metadata:\n    labels:\n        app: nginx\n    spec:\n    containers:\n        - name: nginx\n        image: nginx\n        ports:\n            - containerPort: 80\n---\napiVersion: v1\nkind: Service\nmetadata:\nname: nginx\nnamespace: default\nlabels:\n    app: nginx\nannotations:\n    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"\nspec:\nexternalTrafficPolicy: Local\nports:\n    - name: http\n    port: 80\n    protocol: TCP\n    targetPort: 80\nselector:\n    app: nginx\ntype: LoadBalancer\n'))))),(0,a.kt)("h2",{id:"scheduling-and-creating-targets"},"Scheduling and creating Targets"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"../getting-started/core-concept#target"},"Target")," defines the namespace in runtime cluster for application delivery. Once Target created, namespace in runtime cluster created accordingly."),(0,a.kt)("p",null,"Target must belong to one Project. When there're many Projects to manage, it's very critical that you place Target in an organized manner."),(0,a.kt)("p",null,"Clicking ",(0,a.kt)("inlineCode",{parentName:"p"},"New Target")," into the creating process. Type in necessary Infos as Project, Cluster, Namespace to create. We create targets in one project for different clusters. Or you can create targets by using the several namespaces of one cluster. For now, we at least give it to 3 Targets: 1 for test and 2 for prod environments."),(0,a.kt)("h2",{id:"creating-kubernetes-application"},"Creating Kubernetes application"),(0,a.kt)("p",null,"After Target was created, we begin to create an application. Same to ",(0,a.kt)("a",{parentName:"p",href:"../quick-start"},"Deploy First Application"),", we need to submit basic Infos:"),(0,a.kt)("p",null,"(1) Select type: k8s-objects; NOTE that in one application please maintain at most one Workload type of resource, meaning without more than a Deployment or Statefulset."),(0,a.kt)("p",null,"(2) We schedule two environments, test and prod. Test environment links to the target for dev and prod environment select the other two targets."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(60476).Z})),(0,a.kt)("p",null,"(3) Upload your Yaml file. Note that, the name of the resource you specified must not conflict with existing ones. Also, the editor automatically formats the Yaml file."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(5443).Z})),(0,a.kt)("p",null,"After above, click ",(0,a.kt)("inlineCode",{parentName:"p"},"Create")," to finish."),(0,a.kt)("h2",{id:"deploying-test-environment"},"Deploying test environment"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(20282).Z})),(0,a.kt)("p",null,"Enter the further page, the application has automatically generated 2 environments and 2 workflows. Each environment has its workflow by default. A workflow consists of one or more steps such as ",(0,a.kt)("inlineCode",{parentName:"p"},"deploy2env"),"."),(0,a.kt)("p",null,"Firstly let's switch to the Tab of the test environment, click Deploy on the page. Since we only assigned one target for the test environment, there's one step for workflow. Looking at the status of its execution in the upper-right, it turns green when succeeded. If it shows red means that workflow went into trouble, you can click on the red sign to look through the detailed reason. Fix it accordingly and the deployment will continue to be regained."),(0,a.kt)("p",null,"After deployment is finished, refresh the list of instances to see Pods. Click for more if Pod shows abnormality."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(56688).Z})),(0,a.kt)("p",null,"As for the test environment, it sure can be updated at any time. When we update the parameters(image, instance), execute the workflow for an upgrade. Note that, choose the workflow for the test environment."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(78938).Z})),(0,a.kt)("h2",{id:"deploying-prod-environment"},"Deploying prod environment"),(0,a.kt)("p",null,"Let's switch to the Tab of the prod environment. It shows that it's not deployed yet. So now you can understand one basic thing for KubeVela, different environments in one application are completely dependant on each other, of each is an individual Application CR. "),(0,a.kt)("p",null,"As we have two targets for the prod environment, it'll execute in sequence. If you hope to set up a manual approval before it gets into the second target, this is where workflow comes in."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(65567).Z})),(0,a.kt)("p",null,"we can see two generated workflow. Now we click the ",(0,a.kt)("inlineCode",{parentName:"p"},"Edit")," in the workflow of the prod environment, drag out the ",(0,a.kt)("inlineCode",{parentName:"p"},"suspend")," into the board at the right. Set up the configuration you needed."),(0,a.kt)("p",null,"Then we need to orchestrate their sequence. First disconnect existing steps (by clicking the line + delete button), connect the suspend step in the middle. After editing, you need to click the Save button on the upper right to save."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(15014).Z})),(0,a.kt)("p",null,"Back to the page of prod environment, click Deploy."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(56193).Z})),(0,a.kt)("p",null,"Monitoring the status on the upper right. When the first target finished deploying, a window pops up for you to give out a command."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"suspend")," has three operations:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Rollback: the revision reverts to the latest one in history, even with the first Target."),(0,a.kt)("li",{parentName:"ul"},"Terminate: stop the deployment process but it will not change the first Target that already deployed."),(0,a.kt)("li",{parentName:"ul"},"Continue: enter the execution of the next step.")),(0,a.kt)("p",null,"If continued, the deployment goes on. In the list of instances, you can check out all the details. "),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(93820).Z})),(0,a.kt)("p",null,"Congrats! Now you've learned how to deploy Kubernetes raw resources."),(0,a.kt)("h2",{id:"next-step"},"Next step"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"./helm"},"Deploy Helm Chart"))))}c.isMDXComponent=!0},20282:function(e,t,n){"use strict";t.Z=n.p+"assets/images/app-dashboard-1ae37672b0cb8e31c268632386177585.jpg"},65567:function(e,t,n){"use strict";t.Z=n.p+"assets/images/app-workflow-83ca875d8c9d2e999d3602a15b1e745c.jpg"},5443:function(e,t,n){"use strict";t.Z=n.p+"assets/images/config-k8s-app-4f70a4523395d14f7a63238e37db8ca7.jpg"},60476:function(e,t,n){"use strict";t.Z=n.p+"assets/images/create-k8s-app-483efa386c1b3430e6f33054dd5c4e2f.jpg"},93820:function(e,t,n){"use strict";t.Z=n.p+"assets/images/multiple-target-pods-78341133751097ef14e41eab85257745.jpg"},56688:function(e,t,n){"use strict";t.Z=n.p+"assets/images/pod-list-5f3ab65c80c9c662869ab0774e3763f7.jpg"},78938:function(e,t,n){"use strict";t.Z=n.p+"assets/images/select-workflow-e7c88b798b83072f15fb7170eed42075.jpg"},15014:function(e,t,n){"use strict";t.Z=n.p+"assets/images/workflow-edit-d7e36aca89b22c7d1735d7035b39eaa4.jpg"},56193:function(e,t,n){"use strict";t.Z=n.p+"assets/images/workflow-suspend-c5d95aade908022475093f07b760c74a.jpg"}}]);